# Полная инструкция по деплою на Railway

## Важно: Настройка Dyno для避免 конфликтов

На Railway часто возникает ошибка `Conflict: terminated by other getUpdates request` когда запущено несколько worker процессов.

**Решение:** Убедитесь, что в настройках Railway настроена только **ОДН** инстанция бота.

### Шаг 1: Создание проекта на Railway

1. Перейдите на https://railway.app
2. Нажмите **"New Project"**
3. Выберите **"Deploy from GitHub repo"**

### Шаг 2: Подключение GitHub

1. Авторизуйте Railway доступ к вашему GitHub
2. Выберите ваш репозиторий с ботом

### Шаг 3: Добавление PostgreSQL базы данных

1. В проекте нажмите **"+ New"**
2. Выберите **"Database"** → **"Add PostgreSQL"**
3. Railway автоматически создаст переменную `DATABASE_URL`

### Шаг 4: Добавление переменных окружения

1. В настройках проекта перейдите в **Variables**
2. Добавьте новую переменную:
   - **Ключ:** `TELEGRAM_BOT_TOKEN`
   - **Значение:** Ваш токен от @BotFather (без пробелов!)

### Шаг 5: Настройка количества инстансов

**КРИТИЧНО:** Чтобы избежать ошибок конфликта:

1. Перейдите в настройки service
2. В разделе **Deploy** найдите **"Scale"** или **"Replicas"**
3. Установите значение **1** (один инстанс)
4. Убедитесь, что количество workers установлено на **1**

### Шаг 6: Деплой

1. Railway автоматически задеплоит бот при каждом push в GitHub
2. Проверьте логи в Railway Dashboard, чтобы убедиться, что бот запустился

## Проверка работы

1. Откройте Telegram
2. Найдите вашего бота и отправьте `/start`
3. Бот должен ответить приветственным сообщением

## Если все еще есть ошибки

Если вы видите ошибку `Conflict: terminated by other getUpdates request`:

1. Перейдите в Railway Dashboard
2. Остановите все инстансы бота
3. Убедитесь, что количество replicas установлено на 1
4. Перезапустите deploy

## Структура файлов

```
├── bot.py              # Основной файл бота
├── requirements.txt    # Python зависимости
├── Procfile            # Команда запуска (web, не worker)
├── runtime.txt         # Версия Python
└── railway.json        # Конфигурация Railway
```

## Получение токена бота

1. Откройте Telegram и найдите @BotFather
2. Отправьте `/newbot` или `/token`
3. Следуйте инструкциям
4. Скопируйте токен (без пробелов!)

## Важные замечания

- Бот использует режим Polling для локального тестирования
- На Railway рекомендуется использовать только **один инстанс** (replicas: 1)
- Убедитесь, что токен скопирован **без пробелов** в начале/конце
- PostgreSQL автоматически создает таблицу логирования при первом запуске
